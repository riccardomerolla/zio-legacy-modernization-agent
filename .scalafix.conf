rules = [
  # Semantic Rules (Require compilation)
  OrganizeImports,
  RemoveUnused,
  ExplicitResultTypes,
  
  # Syntactic Rules (Format & Hygiene)
  DisableSyntax,
  LeakingImplicitClassVal,
  NoValInForComprehension,
  ProcedureSyntax,
  RedundantSyntax
]

# --- ZIO & Beautiful Code Configuration ---

OrganizeImports {
  # Group imports to separate Java, Scala, and ZIO dependencies clearly
  groups = [
    "re:javax?\\.",   # Java standard libs
    "scala.",         # Scala standard libs
    "zio.",           # ZIO core and ecosystem
    "*"               # Everything else (libraries, domain code)
  ]
  removeUnused = true
  coalesceToWildcardImportThreshold = 5 # Avoids wildcard imports unless 5+ items
  expandRelative = true                 # Fixes relative imports for better refactoring safety
  groupedImports = Merge                # Merges multiple imports from same package
  importSelectorsOrder = Ascii
  importsOrder = Ascii
  preset = DEFAULT
  targetDialect = Scala3                # CRITICAL: Use Scala 3 wildcard syntax (.*) instead of Scala 2 (._)
}

DisableSyntax {
  noVars = true                # Use Ref for mutable state in ZIO
  noThrows = true              # Use ZIO.fail instead of throw
  noNulls = true               # Use Option for null safety
  noReturns = true             # Breaking referential transparency
  noWhileLoops = true          # Use recursion or ZStream
  noFinalize = true            # Garbage collection best practice
  noValPatterns = true         # Prevents pattern matching in val assignment
  
  # Ban println to enforce using ZIO Console or logging
  regex = [
    {
      id = "noPrintln"
      pattern = "println"
      message = "Avoid println. Use ZIO.log or Console.printLine for effectful logging."
    }
    {
      id = "noInstantNow"
      pattern = "Instant\\.now\\("
      message = "Avoid java.time.Instant.now. Use zio.Clock.instant."
    }
    {
      id = "noSystemCurrentTimeMillis"
      pattern = "System\\.currentTimeMillis\\("
      message = "Avoid System.currentTimeMillis. Use zio.Clock.currentTime(TimeUnit.MILLISECONDS)."
    }
    {
      id = "noSystemNanoTime"
      pattern = "System\\.nanoTime\\("
      message = "Avoid System.nanoTime. Use zio.Clock.nanoTime."
    }
    {
      id = "noThreadSleep"
      pattern = "Thread\\.sleep\\("
      message = "Avoid Thread.sleep. Use ZIO.sleep."
    }
    {
      id = "noJavaUtilRandom"
      pattern = "java\\.util\\.Random"
      message = "Avoid java.util.Random. Use the ZIO Random service."
    }
    {
      id = "noScalaUtilRandom"
      pattern = "scala\\.util\\.Random"
      message = "Avoid scala.util.Random. Use the ZIO Random service."
    }
  ]
}

ExplicitResultTypes {
  # Essential for ZIO to prevent type inference from leaking internal implementation details
  memberVisibility = [Public, Protected]
  skipSimpleDefinitions = true
}

RemoveUnused {
  imports = true
  privates = true
  locals = true
  patternvars = true
}
